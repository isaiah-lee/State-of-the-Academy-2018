function generateTooltip(e){return"<h4>"+e.title+"</h4><p>Responses: <strong>"+e.responses+"</strong><br>Percentage: <strong>"+(100*e.percentage).toFixed(1)+"%</strong></p>"}d3.selectAll(".map").each(function(){var e,t=this.dataset.url,s=0,n=["Discontinuous","Northeast","Southeast","Southwest","West","Midwest","International"],o=this.dataset.responses.split(",").map(function(e,t){return s+=parseInt(e),{responses:parseInt(e),name:n[t]}}),d=this,l=d3.select(this.firstChild);d3.svg(t).then(function(t){var n=t.documentElement;d3.select(d).node().appendChild(n),d3.select(n).selectAll("*").data(o).on("mouseover",function(t,n){e=generateTooltip({title:t.name,responses:t.responses,percentage:t.responses/s}),l.classed("hidden",!1).html(e),console.log(d3.select(d).node().getBoundingClientRect());d3.select(d).node().getBoundingClientRect(),d3.mouse(this)}).on("mousemove",function(e){d3.select(d).node().getBoundingClientRect();var t=d3.mouse(d);l.style("left",t[0]-Math.round(l.node().offsetWidth/2)+"px").style("top",t[1]-Math.round(l.node().offsetHeight)-10+"px")}).on("mouseout",function(e){l.classed("hidden",!0)})})});var percentageSliders=d3.selectAll(".percentage-slider").each(function(){var e=parseInt(this.dataset.yes),t=parseInt(this.dataset.no),s=generateTooltip({title:"Yes",responses:e,percentage:e/(e+t)}),n=generateTooltip({title:"No",responses:t,percentage:t/(e+t)}),o=d3.select(this.firstChild),d=parseInt(d3.select(this.children[1]).node().style.width.replace("%","")),l=parseInt(d3.select(this.children[2]).node().style.width.replace("%",""));d3.select(this.children[1]).on("mouseover",function(e){o.classed("hidden",!1).html(s).style("left","calc("+Math.round(d/2)+"% - "+Math.round(o.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(o.node().offsetHeight)+10)+"px")}).on("mouseout",function(e){o.classed("hidden",!0)}),d3.select(this.children[2]).on("mouseover",function(e){o.classed("hidden",!1).html(n).style("left","calc("+Math.round(d+l/2)+"% - "+Math.round(o.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(o.node().offsetHeight)+10)+"px")}).on("mouseout",function(e){o.classed("hidden",!0)})});