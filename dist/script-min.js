function generateTooltip(t){return"<h4>"+t.title+"</h4><p>Responses: <strong>"+t.responses+"</strong>"+(t.percentage?"<br>Percentage: <strong>"+(100*t.percentage).toFixed(1)+"%</strong>":"")+"</p>"}$(document).ready(function(){$("#sidebar a").on("click",function(t){if(""!==this.hash){t.preventDefault();var e=this.hash;$("html, body").animate({scrollTop:$(e).offset().top},800,function(){window.location.hash=e})}}),$(document).scroll(function(){$(document).scrollTop()+60>$("#sections").offset().top?($("#sidebar").css("position","fixed"),$("#sidebar").css("top","40px")):($("#sidebar").css("position","absolute"),$("#sidebar").css("top","80px"))})}),d3.selectAll(".line_chart").each(function(){var t,e=this.dataset.accent,s=d3.select(this),n=this.dataset.csv,a=this.dataset.x,o=this.dataset.y,r=20,d=20,l=50,i=50,c=s.node().offsetWidth-i-d,p=parseInt(this.dataset.height)-r-l,h=d3.select(this.firstChild),u=[];$.ajax({url:n,success:function(n){n.split("\n").map(function(t){var e=t.split(",");e[0]&&u.push({x:parseInt(e[0]),y:parseInt(e[1])})});var f=d3.scaleLinear().range([0,c]),m=d3.scaleLinear().range([p,0]),y=d3.bisector(function(t){return t.x}).right,g=d3.line().x(function(t){return f(t.x)}).y(function(t){return m(t.y)}),x=s.append("svg").attr("width",c+i+d).attr("height",p+r+l).on("mousemove",function(){var e=f.invert(d3.mouse(this)[0]),s=y(u,e,1),n=u[s-1],a=u[s];if(n&&a){var o=e-n.x>a.x-e?a:n;t=generateTooltip({title:o.x,responses:o.y,percentage:null}),h.classed("hidden",!1).html(t),h.style("left",f(o.x)+5+"px").style("top",m(o.y)-Math.round(h.node().offsetHeight)+10+"px")}}).on("mouseout",function(t){var e=d3.event.toElement;e.parentNode.parentNode!=this.parentNode&&e.parentNode!=this.parentNode&&e!=this.parentNode&&h.classed("hidden",!0)}).append("g").attr("transform","translate("+i+","+r+")");f.domain(d3.extent(u,function(t){return t.x})),m.domain([0,d3.max(u,function(t){return t.y})]),x.append("path").data([u]).attr("class","line").style("stroke",e).style("stroke-width","2px").style("fill","none").attr("d",g),x.selectAll(".dot").data(u).enter().append("circle").attr("class","dot").style("fill",e).attr("cx",function(t){return f(t.x)}).attr("cy",function(t){return m(t.y)}).attr("r",5),x.append("g").style("font-family","source_sans_pro").attr("transform","translate(0,"+p+")").call(d3.axisBottom(f)),x.append("g").style("font-family","source_sans_pro").call(d3.axisLeft(m)),x.append("text").attr("transform","rotate(-90)").attr("y",0-i).attr("x",0-p/2).attr("dy","1em").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text(o),x.append("text").attr("transform","translate("+c/2+" ,"+(p+r+20)+")").style("text-anchor","middle").style("font-family","source_sans_pro").style("font-weight","bold").text(a)},dataType:"text"})}),d3.selectAll(".map").each(function(){var t,e=0,s=["Discontinuous","Northeast","Southeast","Southwest","West","Midwest","International"],n=this.dataset.responses.split(",").map(function(t,n){return e+=parseInt(t),{responses:parseInt(t),name:s[n]}}),a=this,o=d3.select(this.firstChild);d3.svg(this.dataset.url).then(function(s){var r=s.documentElement;d3.select(a).node().appendChild(r),d3.select(r).selectAll("*").data(n).on("mouseover",function(s,n){t=generateTooltip({title:s.name,responses:s.responses,percentage:s.responses/e}),o.classed("hidden",!1).html(t)}).on("mousemove",function(t){var e=d3.mouse(a);o.style("left",e[0]-Math.round(o.node().offsetWidth/2)+"px").style("top",e[1]-Math.round(o.node().offsetHeight)-10+"px")}).on("mouseout",function(t){o.classed("hidden",!0)})})});var percentageSliders=d3.selectAll(".percentage-slider").each(function(){var t=parseInt(this.dataset.yes),e=parseInt(this.dataset.no),s=generateTooltip({title:"Yes",responses:t,percentage:t/(t+e)}),n=generateTooltip({title:"No",responses:e,percentage:e/(t+e)}),a=d3.select(this.firstChild),o=parseInt(d3.select(this.children[1]).node().style.width.replace("%","")),r=parseInt(d3.select(this.children[2]).node().style.width.replace("%",""));d3.select(this.children[1]).on("mouseover",function(t){a.classed("hidden",!1).html(s).style("left","calc("+Math.round(o/2)+"% - "+Math.round(a.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(a.node().offsetHeight)+10)+"px")}).on("mouseout",function(t){a.classed("hidden",!0)}),d3.select(this.children[2]).on("mouseover",function(t){a.classed("hidden",!1).html(n).style("left","calc("+Math.round(o+r/2)+"% - "+Math.round(a.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(a.node().offsetHeight)+10)+"px")}).on("mouseout",function(t){a.classed("hidden",!0)})}),pieCharts=d3.selectAll(".pie").each(function(){var t,e,s=this.dataset.responses.split(","),n=this.dataset.labels.split(","),a=d3.color(this.dataset.accent),o=0,r=s.map(function(t,e){return o+=parseInt(t),0!=e&&(a=d3.color(a.darker())),{label:n[e],value:parseInt(t),color:d3.rgb(a)}}),d=(d3.scaleOrdinal(d3.schemeCategory20c),d3.pie().value(function(t){return t.value})),l=d3.arc().outerRadius(150).innerRadius(75),i=d3.select(this.firstChild),c=this;d3.select(this).append("svg").attr("width","100%").attr("height",300).append("g").attr("transform","translate(150,150)").selectAll("path").data(d(r)).enter().append("path").attr("fill",function(t,e){return t.data.color}).attr("stroke","white").attr("d",l).on("mouseover",function(e,s){t=generateTooltip({title:e.data.label,responses:e.value,percentage:e.value/o}),i.classed("hidden",!1).html(t)}).on("mousemove",function(t){e=d3.mouse(c),i.style("left",e[0]-Math.round(i.node().offsetWidth/2)+"px").style("top",e[1]-Math.round(i.node().offsetHeight)-12+"px")}).on("mouseout",function(t){i.classed("hidden",!0)});d3.select(this).append("div").attr("class","pie-label").attr("width","100%").selectAll("p").data(r).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t.color+"'></div>"+t.label})});