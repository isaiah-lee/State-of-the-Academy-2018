function generateTooltip(e){return"<h4>"+e.title+"</h4><p>Responses: <strong>"+e.responses+"</strong><br>Percentage: <strong>"+(100*e.percentage).toFixed(1)+"%</strong></p>"}$(document).ready(function(){$("#sidebar a").on("click",function(e){if(""!==this.hash){e.preventDefault();var t=this.hash;$("html, body").animate({scrollTop:$(t).offset().top},800,function(){window.location.hash=t})}}),$(document).scroll(function(){$(document).scrollTop()+60>$("#sections").offset().top?($("#sidebar").css("position","fixed"),$("#sidebar").css("top","40px")):($("#sidebar").css("position","absolute"),$("#sidebar").css("top","80px"))})}),d3.selectAll(".map").each(function(){var e,t=0,s=["Discontinuous","Northeast","Southeast","Southwest","West","Midwest","International"],n=this.dataset.responses.split(",").map(function(e,n){return t+=parseInt(e),{responses:parseInt(e),name:s[n]}}),o=this,a=d3.select(this.firstChild);d3.svg(this.dataset.url).then(function(s){var d=s.documentElement;d3.select(o).node().appendChild(d),d3.select(d).selectAll("*").data(n).on("mouseover",function(s,n){e=generateTooltip({title:s.name,responses:s.responses,percentage:s.responses/t}),a.classed("hidden",!1).html(e)}).on("mousemove",function(e){var t=d3.mouse(o);a.style("left",t[0]-Math.round(a.node().offsetWidth/2)+"px").style("top",t[1]-Math.round(a.node().offsetHeight)-10+"px")}).on("mouseout",function(e){a.classed("hidden",!0)})})});var percentageSliders=d3.selectAll(".percentage-slider").each(function(){var e=parseInt(this.dataset.yes),t=parseInt(this.dataset.no),s=generateTooltip({title:"Yes",responses:e,percentage:e/(e+t)}),n=generateTooltip({title:"No",responses:t,percentage:t/(e+t)}),o=d3.select(this.firstChild),a=parseInt(d3.select(this.children[1]).node().style.width.replace("%","")),d=parseInt(d3.select(this.children[2]).node().style.width.replace("%",""));d3.select(this.children[1]).on("mouseover",function(e){o.classed("hidden",!1).html(s).style("left","calc("+Math.round(a/2)+"% - "+Math.round(o.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(o.node().offsetHeight)+10)+"px")}).on("mouseout",function(e){o.classed("hidden",!0)}),d3.select(this.children[2]).on("mouseover",function(e){o.classed("hidden",!1).html(n).style("left","calc("+Math.round(a+d/2)+"% - "+Math.round(o.node().offsetWidth/2)+"px)").style("top","-"+(Math.round(o.node().offsetHeight)+10)+"px")}).on("mouseout",function(e){o.classed("hidden",!0)})}),pieCharts=d3.selectAll(".pie").each(function(){var e,t,s=this.dataset.responses.split(","),n=this.dataset.labels.split(","),o=d3.color(this.dataset.accent),a=0,d=s.map(function(e,t){return a+=parseInt(e),0!=t&&(o=d3.color(o.darker())),{label:n[t],value:parseInt(e),color:d3.rgb(o)}}),l=(d3.scaleOrdinal(d3.schemeCategory20c),d3.pie().value(function(e){return e.value})),i=d3.arc().outerRadius(150).innerRadius(75),r=d3.select(this.firstChild),c=this;d3.select(this).append("svg").attr("width","100%").attr("height",300).append("g").attr("transform","translate(150,150)").selectAll("path").data(l(d)).enter().append("path").attr("fill",function(e,t){return e.data.color}).attr("stroke","white").attr("d",i).on("mouseover",function(t,s){e=generateTooltip({title:t.data.label,responses:t.value,percentage:t.value/a}),r.classed("hidden",!1).html(e)}).on("mousemove",function(e){t=d3.mouse(c),r.style("left",t[0]-Math.round(r.node().offsetWidth/2)+"px").style("top",t[1]-Math.round(r.node().offsetHeight)-12+"px")}).on("mouseout",function(e){r.classed("hidden",!0)});d3.select(this).append("div").attr("class","pie-label").attr("width","100%").selectAll("p").data(d).enter().append("p").html(function(e,t){return"<div class = 'bubble' style = 'background:"+e.color+"'></div>"+e.label})});